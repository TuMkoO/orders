import{_ as Q,Z as U,r as _,a as A,B as g,o as V,$ as h,g as r,d as p,f as c,e as l,j as k,w as u,O as f,i as M,ar as L,Q as I,P,R as j,W as N,X as T,as as H,at as z,au as R,u as D,Y as E}from"./index.492bf3e5.js";import{A as O,Q as B,a as W,b as X}from"./AppModal.57ba6dc7.js";import{Q as Y}from"./QTr.57cb137e.js";import{L as Z}from"./ListenersForm.9cc924cb.js";import"./ClosePopup.54800676.js";import"./use-checkbox.b51cc728.js";import"./QCard.96e0af9a.js";import"./use-cache.b0833c75.js";import"./QToggle.692149fb.js";import"./QCardSection.2717de3b.js";import"./array.b3882730.js";import"./QCardActions.71af93fa.js";const G=[{name:"fio",required:!0,label:"\u0424\u0418\u041E",align:"left",field:o=>o.firstName+" "+o.secondName+" "+o.lastName,format:o=>`${o}`,sortable:!0},{name:"post",align:"left",label:"\u0414\u043E\u043B\u0436\u043D\u043E\u0441\u0442\u044C",field:"post",sortable:!0},{name:"company",align:"left",label:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u0435",field:"ownerUser",sortable:!0},{name:"phone",align:"left",label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",field:"phone",sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"status",align:"left",label:"\u0421\u0442\u0430\u0442\u0443\u0441",field:"status",sortable:!0},{name:"control",align:"center",label:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435",field:""}],J={components:{AppLoader:U,AppModal:O,ListenersForm:Z},setup(){const o=_(!1),a=A(),n=g(()=>a.getters["auth/user"]),e=g(()=>a.getters["auth/users"]),m=_(!1),s=_(""),y=g(()=>a.getters["listener/listeners"]),b=g(()=>a.getters["listener/listeners"].filter(d=>s.value&&!m.value?d.firstName.toLowerCase().includes(s.value.toLowerCase())||d.secondName.toLowerCase().includes(s.value.toLowerCase())||d.lastName.toLowerCase().includes(s.value.toLowerCase())||n.value.companyShortName.toLowerCase().includes(s.value.toLowerCase())||n.value.companyFullName.toLowerCase().includes(s.value.toLowerCase()):s.value&&m.value?d.firstName.toLowerCase().includes(s.value.toLowerCase())||d.secondName.toLowerCase().includes(s.value.toLowerCase())||d.lastName.toLowerCase().includes(s.value.toLowerCase())||n.value.companyShortName.toLowerCase().includes(s.value.toLowerCase())||n.value.companyFullName.toLowerCase().includes(s.value.toLowerCase())||e.value.filter(w=>w._id==d.ownerUser)[0].companyShortName.toLowerCase().includes(s.value.toLowerCase())||e.value.filter(w=>w._id==d.ownerUser)[0].companyFullName.toLowerCase().includes(s.value.toLowerCase()):!0)),v=_(!1),t=_(""),i=_(""),x=_();V(async()=>{o.value=!0,n.value.roles.length&&(n.value.roles.includes("admin")||n.value.roles.includes("god")?m.value=!0:m.value=!1),o.value=!1});const S=async()=>{o.value=!0,m.value?await a.dispatch("listener/load"):await a.dispatch("listener/loadByCompany",n.value.id),o.value=!1},F=async(d,w)=>{w&&(x.value=await a.dispatch("listener/loadById",w._id)),d=="delete"?(t.value="delete",i.value="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F"):d=="add"?(t.value="add",i.value="\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0433\u043E \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F",m.value&&await a.dispatch("auth/loadUsers")):d=="edit"&&(t.value="edit",i.value="\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F",m.value&&await a.dispatch("auth/loadUsers")),v.value=!0},q=()=>{v.value=!1,t.value="",i.value=""};return{initialPagination:{sortBy:"fio",descending:!1,page:1,rowsPerPage:10},user:n,users:e,search:s,columns:G,loading:o,rows:y,filteredRows:b,modal:v,modalTitle:i,modalType:t,currentListener:x,showModal:F,closeModal:q,deleteListener:async d=>{await a.dispatch("listener/remove",d),S(),q()},updateListener:()=>{S(),q()}}}},C=o=>(z("data-v-362dc3ef"),o=o(),R(),o),K={class:"w-100"},$={key:0},ee={key:1},ae=C(()=>l("p",{class:"text-center"},"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438 \u043D\u0435 \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u044B",-1)),te={class:"text-center"},oe={key:2},se={class:"row justify-between"},le={style:{flex:"1"}},ne={key:0},re={class:"text-bold"},ie={class:"table-nav"},de={key:0,class:"q-card__section q-card__section--vert"},ce={key:1,class:"q-card__actions justify-end q-card__actions--horiz row"},ue=C(()=>l("span",{class:"q-focus-helper"},null,-1)),me=C(()=>l("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[l("span",{class:"block"},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C")],-1)),pe=[ue,me],_e=C(()=>l("span",{class:"q-focus-helper"},null,-1)),ve=C(()=>l("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[l("span",{class:"block"},"\u041E\u0442\u043C\u0435\u043D\u0430")],-1)),fe=[_e,ve];function be(o,a,n,e,m,s){const y=h("AppLoader"),b=h("ListenersForm"),v=h("app-modal");return r(),p("div",K,[e.loading?(r(),p("div",$,[c(y)])):!e.loading&&!e.rows.length?(r(),p("div",ee,[ae,l("div",te,[c(k,{label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",type:"button",color:"primary",onClick:a[0]||(a[0]=t=>e.showModal("add"))})])])):(r(),p("div",oe,[l("div",se,[l("div",le,[c(I,{"bottom-slots":"",modelValue:e.search,"onUpdate:modelValue":a[2]||(a[2]=t=>e.search=t),label:"\u0414\u043B\u044F \u0444\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041E \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F \u0438\u043B\u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u044F"},{append:u(()=>[e.search!==""?(r(),f(M,{key:0,name:"close",onClick:a[1]||(a[1]=t=>e.search=""),class:"cursor-pointer"})):L("",!0),c(M,{name:"search"})]),_:1},8,["modelValue"])])]),e.user&&e.users&&e.user.companyShortName?(r(),p("div",ne,[c(W,{rows:e.filteredRows,columns:e.columns,"row-key":"name",pagination:e.initialPagination},{header:u(t=>[c(Y,{props:t},{default:u(()=>[(r(!0),p(P,null,j(t.cols,i=>(r(),f(X,{key:i.name,props:t,class:"text-center"},{default:u(()=>[l("span",re,T(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-company":u(t=>[c(B,{props:t},{default:u(()=>[N(T(t.row.ownerUser==e.user.id?e.user.companyShortName:e.users.map(i=>i).filter(i=>i._id==t.row.ownerUser)[0].companyShortName),1)]),_:2},1032,["props"])]),"body-cell-control":u(t=>[c(B,{props:t},{default:u(()=>[l("div",null,[c(k,{class:"bg-orange q-mr-sm",icon:"edit_note",onClick:i=>e.showModal("edit",t.row)},null,8,["onClick"]),c(k,{class:"bg-red",icon:"delete",onClick:i=>e.showModal("delete",t.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])):L("",!0),l("div",ie,[c(k,{fab:"",icon:"add",onClick:a[3]||(a[3]=t=>e.showModal("add")),color:"secondary"})])])),(r(),f(H,{to:"body"},[c(v,{title:e.modalTitle,show:e.modal,fullSize:e.modalType!="delete",onClose:e.closeModal},{default:u(()=>[e.modalType=="delete"?(r(),p("div",de,[N(" \u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044C "),l("b",null,T(e.currentListener.firstName+" "+e.currentListener.secondName+" "+e.currentListener.lastName),1),N(" \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0451\u043D. \u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435? ")])):L("",!0),e.modalType=="delete"?(r(),p("div",ce,[l("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:a[4]||(a[4]=t=>e.deleteListener(e.currentListener._id))},pe),l("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-positive q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:a[5]||(a[5]=(...t)=>e.closeModal&&e.closeModal(...t))},fe)])):L("",!0),e.modalType=="add"?(r(),f(b,{key:2,buttonTitle:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",submitType:"add",onSuccess:e.updateListener,onHide:e.closeModal},null,8,["onSuccess","onHide"])):e.modalType=="edit"?(r(),f(b,{key:3,buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"update",listener:e.currentListener,onSuccess:e.updateListener,onHide:e.closeModal},null,8,["listener","onSuccess","onHide"])):L("",!0)]),_:1},8,["title","show","fullSize","onClose"])]))])}var we=Q(J,[["render",be],["__scopeId","data-v-362dc3ef"]]);const he={title:"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438",titleTemplate:o=>`${o} | \u041D\u043E\u0432\u044B\u0435 \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0438`},ye={setup(){D(he);const o=_(!1),a=A(),n=g(()=>a.getters["auth/user"]);return V(async()=>{o.value=!0,n.value.roles.length&&(n.value.roles.includes("admin")||n.value.roles.includes("god")?(await a.dispatch("listener/load"),await a.dispatch("auth/loadUsers")):await a.dispatch("listener/loadByCompany",n.value.id)),o.value=!1}),{loading:o}},components:{AppPage:E,AppLoader:U,ListenersTable:we}},Le={class:"q-gutter-y-md"},ge={key:0};function Ce(o,a,n,e,m,s){const y=h("AppLoader"),b=h("ListenersTable"),v=h("app-page");return r(),f(v,{title:"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438"},{default:u(()=>[l("div",Le,[e.loading?(r(),p("div",ge,[c(y)])):(r(),f(b,{key:1}))])]),_:1})}var Pe=Q(ye,[["render",Ce]]);export{Pe as default};
