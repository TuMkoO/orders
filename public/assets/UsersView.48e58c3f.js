var h=(o,t,u)=>new Promise((e,b)=>{var p=i=>{try{l(u.next(i))}catch(a){b(a)}},c=i=>{try{l(u.throw(i))}catch(a){b(a)}},l=i=>i.done?e(i.value):Promise.resolve(i.value).then(p,c);l((u=u.apply(o,t)).next())});import{Q as U,b as j,a as T}from"./QTabPanels.d1cede7d.js";import{_ as N,Z as Q,r as _,a as V,o as B,D as A,$ as g,g as d,d as f,f as s,w as r,P as F,R as L,e as m,X as v,W as k,j as x,O as w,ar as z,as as D,u as E,B as O,ay as R,Y as W,a0 as X,a1 as Y}from"./index.6a3e913b.js";import{Q as Z}from"./QCard.aee1e3f8.js";import{U as S}from"./UsersForm.840ad45c.js";import{A as G,Q as q,a as H,b as I}from"./AppModal.f42ad3c9.js";import{Q as J}from"./QTr.74ad1202.js";import"./use-cache.b0833c75.js";import"./ClosePopup.4ecda866.js";import"./use-checkbox.344ada42.js";import"./QCardSection.339cec18.js";import"./QCardActions.ef04eaa0.js";import"./array.4a1f6405.js";const K=[{name:"companyShortName",align:"left",label:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u0435",field:"companyShortName",sortable:!0},{name:"companyLegalAddressCity",align:"left",label:"\u0413\u043E\u0440\u043E\u0434",field:"companyLegalAddressCity",sortable:!0},{name:"firstName",align:"left",label:"\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u043E\u0435 \u043B\u0438\u0446\u043E",field:"firstName",sortable:!0},{name:"post",align:"left",label:"\u0414\u043E\u043B\u0436\u043D\u043E\u0441\u0442\u044C",field:"post",sortable:!0},{name:"phone",align:"left",label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",field:"phone",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:o=>o.email,format:o=>`${o}`,sortable:!0},{name:"control",align:"center",label:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435",field:""}],$={components:{AppLoader:Q,AppModal:G,UsersForm:S},props:{users:{type:Array,required:!0}},emits:["update-table"],setup(o,{emit:t}){const u=_(!1),e=V(),b=_([]),p=_(!1),c=_(""),l=_(""),i=_();B(()=>{u.value=!0,o.users.forEach(y=>{b.value.push(y)}),u.value=!1});const a=(y,C)=>h(this,null,function*(){i.value=y,C=="delete"?(c.value="delete",l.value="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C"):(l.value="\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C",yield e.dispatch("settingsConfigurable/load","ownership-type")),p.value=!0}),n=()=>{p.value=!1,c.value="",l.value=""};A(()=>o.users,(y,C)=>{b.value=y});function M(){return h(this,null,function*(){p.value=!1,t("update-table")})}function P(y){return h(this,null,function*(){yield e.dispatch("auth/remove",y),p.value=!1,c.value="",l.value="",t("update-table")})}return{initialPagination:{sortBy:"companyShortName",descending:!1,page:1,rowsPerPage:10},columns:K,rows:b,loading:u,modal:p,modalType:c,modalTitle:l,currentUser:i,showModal:a,closeModal:n,deleteUser:P,updateUsers:M}}},ee={class:"w-100"},ae={key:0},te={key:1},se={key:2},oe={class:"text-bold"},le={style:{"max-width":"250px","white-space":"normal"}},ne={key:0,class:"q-card__section q-card__section--vert"},re={key:1,class:"q-card__actions justify-end q-card__actions--horiz row"},ie=m("span",{class:"q-focus-helper"},null,-1),ce=m("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[m("span",{class:"block"},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C")],-1),de=[ie,ce],ue=m("span",{class:"q-focus-helper"},null,-1),me=m("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[m("span",{class:"block"},"\u041E\u0442\u043C\u0435\u043D\u0430")],-1),pe=[ue,me];function be(o,t,u,e,b,p){const c=g("AppLoader"),l=g("UsersForm"),i=g("app-modal");return d(),f("div",ee,[e.loading?(d(),f("div",ae,[s(c)])):!e.loading&&!e.rows.length?(d(),f("div",te," \u0423\u0447\u0435\u0442\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u044B ")):(d(),f("div",se,[s(H,{rows:e.rows,columns:e.columns,"row-key":"name",pagination:e.initialPagination},{header:r(a=>[s(J,{props:a},{default:r(()=>[(d(!0),f(F,null,L(a.cols,n=>(d(),w(I,{key:n.name,props:a,class:"text-center"},{default:r(()=>[m("span",oe,v(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-companyFullName":r(a=>[s(q,{props:a},{default:r(()=>[m("div",le,v(a.row.companyFullName),1)]),_:2},1032,["props"])]),"body-cell-firstName":r(a=>[s(q,{props:a},{default:r(()=>[k(v(a.row.firstName+" "+a.row.secondName+" "+a.row.lastName),1)]),_:2},1032,["props"])]),"body-cell-control":r(a=>[s(q,{props:a},{default:r(()=>[m("div",null,[s(x,{class:"bg-orange q-mr-sm",icon:"edit_note",onClick:n=>e.showModal(a.row)},null,8,["onClick"]),s(x,{class:"bg-red",icon:"delete",onClick:n=>e.showModal(a.row,"delete")},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])),(d(),w(D,{to:"body"},[s(i,{title:e.modalTitle,show:e.modal,onClose:e.closeModal,fullSize:e.modalType!="delete"},{default:r(()=>[e.modalType=="delete"?(d(),f("div",ne,[k(" \u0423\u0447\u0435\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F "),m("b",null,v(e.currentUser.name),1),k(" \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u0430. \u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435? ")])):z("",!0),e.modalType=="delete"?(d(),f("div",re,[m("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:t[0]||(t[0]=a=>e.deleteUser(e.currentUser._id))},de),m("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-positive q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:t[1]||(t[1]=(...a)=>e.closeModal&&e.closeModal(...a))},pe)])):(d(),w(l,{key:2,buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"update",user:e.currentUser,onSuccess:e.updateUsers,resetPassword:""},null,8,["user","onSuccess"]))]),_:1},8,["title","show","onClose","fullSize"])]))])}var fe=N($,[["render",be]]);const _e={title:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\u043C\u0438",titleTemplate:o=>`${o} | \u041D\u043E\u0432\u044B\u0435 \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0438`},ye={setup(){E(_e);const o=V(),t=_(!1),u=_(""),e=O(()=>o.getters.usersTabsActive),b=_([]),p=_([]),c=_([]);R(()=>h(this,null,function*(){t.value=!0,u.value=e.value,yield o.dispatch("auth/loadUsers"),b.value=o.getters["auth/users"],p.value=o.getters["auth/users"].filter(a=>a.roles.includes("admin")),c.value=o.getters["auth/users"].filter(a=>a.roles.includes("user")),t.value=!1}));const l=a=>{o.dispatch("setUsersTab",a)};A(()=>e.value,(a,n)=>{u.value=a});function i(a){return h(this,null,function*(){yield o.dispatch("auth/loadUsers"),b.value=o.getters["auth/users"],p.value=o.getters["auth/users"].filter(n=>n.roles.includes("admin")),c.value=o.getters["auth/users"].filter(n=>n.roles.includes("user")),(a==null?void 0:a.role)=="user"?l("users"):(a==null?void 0:a.role)=="admin"&&l("admins")})}return{tab:u,loading:t,adminUsers:p,clientUsers:c,updateUsers:i,changeTab:l}},components:{AppPage:W,AppLoader:Q,UsersForm:S,UsersTable:fe}},ge={class:"q-gutter-y-md"},he={key:0,class:"row justify-center"},ve={key:1},we={key:0,class:"row justify-center"},Ue={key:1},Te={class:"row justify-center"};function ke(o,t,u,e,b,p){const c=g("UsersTable"),l=g("AppLoader"),i=g("UsersForm"),a=g("app-page");return d(),w(a,{title:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u044F \u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0435 \u043B\u0438\u0446\u0430"},{default:r(()=>[m("div",ge,[s(Z,null,{default:r(()=>[s(X,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=n=>e.tab=n),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:r(()=>[s(U,{name:"users",label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",onClick:t[0]||(t[0]=n=>e.changeTab("users"))}),s(U,{name:"admins",label:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u044B",onClick:t[1]||(t[1]=n=>e.changeTab("admins"))}),s(U,{name:"register",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",onClick:t[2]||(t[2]=n=>e.changeTab("register"))})]),_:1},8,["modelValue"]),s(Y),s(j,{modelValue:e.tab,"onUpdate:modelValue":t[4]||(t[4]=n=>e.tab=n),animated:""},{default:r(()=>[s(T,{name:"users"},{default:r(()=>[e.loading?(d(),f("div",ve,[s(l)])):(d(),f("div",he,[s(c,{users:e.clientUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),s(T,{name:"admins"},{default:r(()=>[e.loading?(d(),f("div",Ue,[s(l)])):(d(),f("div",we,[s(c,{users:e.adminUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),s(T,{name:"register"},{default:r(()=>[m("div",Te,[s(i,{buttonTitle:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",submitType:"register",onSuccess:e.updateUsers},null,8,["onSuccess"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}var Le=N(ye,[["render",ke]]);export{Le as default};
