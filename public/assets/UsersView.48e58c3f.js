import{Q as w,b as P,a as U}from"./QTabPanels.d1cede7d.js";import{_ as x,Z as N,r as p,a as Q,o as j,D as V,$ as g,g as r,d as m,f as t,w as n,P as B,R as F,e as c,X as h,W as T,j as C,O as v,ar as L,as as z,u as D,B as E,ay as O,Y as R,a0 as W,a1 as X}from"./index.6a3e913b.js";import{Q as Y}from"./QCard.aee1e3f8.js";import{U as A}from"./UsersForm.840ad45c.js";import{A as Z,Q as k,a as G,b as H}from"./AppModal.f42ad3c9.js";import{Q as I}from"./QTr.74ad1202.js";import"./use-cache.b0833c75.js";import"./ClosePopup.4ecda866.js";import"./use-checkbox.344ada42.js";import"./QCardSection.339cec18.js";import"./QCardActions.ef04eaa0.js";import"./array.4a1f6405.js";const J=[{name:"companyShortName",align:"left",label:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u0435",field:"companyShortName",sortable:!0},{name:"companyLegalAddressCity",align:"left",label:"\u0413\u043E\u0440\u043E\u0434",field:"companyLegalAddressCity",sortable:!0},{name:"firstName",align:"left",label:"\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u043E\u0435 \u043B\u0438\u0446\u043E",field:"firstName",sortable:!0},{name:"post",align:"left",label:"\u0414\u043E\u043B\u0436\u043D\u043E\u0441\u0442\u044C",field:"post",sortable:!0},{name:"phone",align:"left",label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",field:"phone",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:o=>o.email,format:o=>`${o}`,sortable:!0},{name:"control",align:"center",label:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435",field:""}],K={components:{AppLoader:N,AppModal:Z,UsersForm:A},props:{users:{type:Array,required:!0}},emits:["update-table"],setup(o,{emit:s}){const b=p(!1),e=Q(),f=p([]),u=p(!1),d=p(""),i=p(""),_=p();j(()=>{b.value=!0,o.users.forEach(y=>{f.value.push(y)}),b.value=!1});const a=async(y,q)=>{_.value=y,q=="delete"?(d.value="delete",i.value="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C"):(i.value="\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C",await e.dispatch("settingsConfigurable/load","ownership-type")),u.value=!0},l=()=>{u.value=!1,d.value="",i.value=""};V(()=>o.users,(y,q)=>{f.value=y});async function S(){u.value=!1,s("update-table")}async function M(y){await e.dispatch("auth/remove",y),u.value=!1,d.value="",i.value="",s("update-table")}return{initialPagination:{sortBy:"companyShortName",descending:!1,page:1,rowsPerPage:10},columns:J,rows:f,loading:b,modal:u,modalType:d,modalTitle:i,currentUser:_,showModal:a,closeModal:l,deleteUser:M,updateUsers:S}}},$={class:"w-100"},ee={key:0},ae={key:1},te={key:2},se={class:"text-bold"},oe={style:{"max-width":"250px","white-space":"normal"}},le={key:0,class:"q-card__section q-card__section--vert"},ne={key:1,class:"q-card__actions justify-end q-card__actions--horiz row"},re=c("span",{class:"q-focus-helper"},null,-1),ie=c("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[c("span",{class:"block"},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C")],-1),ce=[re,ie],de=c("span",{class:"q-focus-helper"},null,-1),ue=c("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[c("span",{class:"block"},"\u041E\u0442\u043C\u0435\u043D\u0430")],-1),me=[de,ue];function pe(o,s,b,e,f,u){const d=g("AppLoader"),i=g("UsersForm"),_=g("app-modal");return r(),m("div",$,[e.loading?(r(),m("div",ee,[t(d)])):!e.loading&&!e.rows.length?(r(),m("div",ae," \u0423\u0447\u0435\u0442\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u044B ")):(r(),m("div",te,[t(G,{rows:e.rows,columns:e.columns,"row-key":"name",pagination:e.initialPagination},{header:n(a=>[t(I,{props:a},{default:n(()=>[(r(!0),m(B,null,F(a.cols,l=>(r(),v(H,{key:l.name,props:a,class:"text-center"},{default:n(()=>[c("span",se,h(l.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-companyFullName":n(a=>[t(k,{props:a},{default:n(()=>[c("div",oe,h(a.row.companyFullName),1)]),_:2},1032,["props"])]),"body-cell-firstName":n(a=>[t(k,{props:a},{default:n(()=>[T(h(a.row.firstName+" "+a.row.secondName+" "+a.row.lastName),1)]),_:2},1032,["props"])]),"body-cell-control":n(a=>[t(k,{props:a},{default:n(()=>[c("div",null,[t(C,{class:"bg-orange q-mr-sm",icon:"edit_note",onClick:l=>e.showModal(a.row)},null,8,["onClick"]),t(C,{class:"bg-red",icon:"delete",onClick:l=>e.showModal(a.row,"delete")},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])),(r(),v(z,{to:"body"},[t(_,{title:e.modalTitle,show:e.modal,onClose:e.closeModal,fullSize:e.modalType!="delete"},{default:n(()=>[e.modalType=="delete"?(r(),m("div",le,[T(" \u0423\u0447\u0435\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F "),c("b",null,h(e.currentUser.name),1),T(" \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u0430. \u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435? ")])):L("",!0),e.modalType=="delete"?(r(),m("div",ne,[c("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:s[0]||(s[0]=a=>e.deleteUser(e.currentUser._id))},ce),c("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-positive q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:s[1]||(s[1]=(...a)=>e.closeModal&&e.closeModal(...a))},me)])):(r(),v(i,{key:2,buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"update",user:e.currentUser,onSuccess:e.updateUsers,resetPassword:""},null,8,["user","onSuccess"]))]),_:1},8,["title","show","onClose","fullSize"])]))])}var be=x(K,[["render",pe]]);const fe={title:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\u043C\u0438",titleTemplate:o=>`${o} | \u041D\u043E\u0432\u044B\u0435 \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0438`},_e={setup(){D(fe);const o=Q(),s=p(!1),b=p(""),e=E(()=>o.getters.usersTabsActive),f=p([]),u=p([]),d=p([]);O(async()=>{s.value=!0,b.value=e.value,await o.dispatch("auth/loadUsers"),f.value=o.getters["auth/users"],u.value=o.getters["auth/users"].filter(a=>a.roles.includes("admin")),d.value=o.getters["auth/users"].filter(a=>a.roles.includes("user")),s.value=!1});const i=a=>{o.dispatch("setUsersTab",a)};V(()=>e.value,(a,l)=>{b.value=a});async function _(a){await o.dispatch("auth/loadUsers"),f.value=o.getters["auth/users"],u.value=o.getters["auth/users"].filter(l=>l.roles.includes("admin")),d.value=o.getters["auth/users"].filter(l=>l.roles.includes("user")),(a==null?void 0:a.role)=="user"?i("users"):(a==null?void 0:a.role)=="admin"&&i("admins")}return{tab:b,loading:s,adminUsers:u,clientUsers:d,updateUsers:_,changeTab:i}},components:{AppPage:R,AppLoader:N,UsersForm:A,UsersTable:be}},ye={class:"q-gutter-y-md"},ge={key:0,class:"row justify-center"},he={key:1},ve={key:0,class:"row justify-center"},we={key:1},Ue={class:"row justify-center"};function Te(o,s,b,e,f,u){const d=g("UsersTable"),i=g("AppLoader"),_=g("UsersForm"),a=g("app-page");return r(),v(a,{title:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u044F \u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0435 \u043B\u0438\u0446\u0430"},{default:n(()=>[c("div",ye,[t(Y,null,{default:n(()=>[t(W,{modelValue:e.tab,"onUpdate:modelValue":s[3]||(s[3]=l=>e.tab=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[t(w,{name:"users",label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",onClick:s[0]||(s[0]=l=>e.changeTab("users"))}),t(w,{name:"admins",label:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u044B",onClick:s[1]||(s[1]=l=>e.changeTab("admins"))}),t(w,{name:"register",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",onClick:s[2]||(s[2]=l=>e.changeTab("register"))})]),_:1},8,["modelValue"]),t(X),t(P,{modelValue:e.tab,"onUpdate:modelValue":s[4]||(s[4]=l=>e.tab=l),animated:""},{default:n(()=>[t(U,{name:"users"},{default:n(()=>[e.loading?(r(),m("div",he,[t(i)])):(r(),m("div",ge,[t(d,{users:e.clientUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),t(U,{name:"admins"},{default:n(()=>[e.loading?(r(),m("div",we,[t(i)])):(r(),m("div",ve,[t(d,{users:e.adminUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),t(U,{name:"register"},{default:n(()=>[c("div",Ue,[t(_,{buttonTitle:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",submitType:"register",onSuccess:e.updateUsers},null,8,["onSuccess"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}var Be=x(_e,[["render",Te]]);export{Be as default};
