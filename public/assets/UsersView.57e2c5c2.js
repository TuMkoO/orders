import{Q as w,b as P,a as U}from"./QTabPanels.a6a75a65.js";import{_ as x,$ as N,r as p,b as Q,o as F,E as V,a0 as y,h as r,e as m,g as t,w as n,R as L,S as j,f as c,Y as h,X as T,k as C,P as v,as as B,at as z,u as E,C as D,az as R,Z as X,a1 as Y,a2 as Z}from"./index.8f4ba276.js";import{Q as G}from"./QCard.c534bcc0.js";import{U as S}from"./UsersForm.654af96f.js";import{A as H,Q as k,a as I,b as J}from"./AppModal.1a346ccd.js";import{Q as K}from"./QTr.d81d2660.js";import"./use-cache.b0833c75.js";import"./ClosePopup.3e6bc9ec.js";import"./use-checkbox.7375de5c.js";import"./QCardSection.21b087d5.js";import"./QCardActions.d38c7677.js";import"./array.12f4553f.js";const O=[{name:"companyShortName",align:"left",label:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u0435",field:"companyShortName",sortable:!0},{name:"companyLegalAddressCity",align:"left",label:"\u0413\u043E\u0440\u043E\u0434",field:"companyLegalAddressCity",sortable:!0},{name:"firstName",align:"left",label:"\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u043E\u0435 \u043B\u0438\u0446\u043E",field:"firstName",sortable:!0},{name:"post",align:"left",label:"\u0414\u043E\u043B\u0436\u043D\u043E\u0441\u0442\u044C",field:"post",sortable:!0},{name:"phone",align:"left",label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",field:"phone",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:o=>o.email,format:o=>`${o}`,sortable:!0},{name:"control",align:"center",label:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435",field:""}],W={components:{AppLoader:N,AppModal:H,UsersForm:S},props:{users:{type:Array,required:!0}},emits:["update-table"],setup(o,{emit:s}){const b=p(!1),e=Q(),f=p([]),u=p(!1),d=p(""),i=p(""),_=p();F(()=>{b.value=!0,o.users.forEach(g=>{f.value.push(g)}),b.value=!1});const a=async(g,q)=>{_.value=g,q=="delete"?(d.value="delete",i.value="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C"):(i.value="\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0443\u0447\u0435\u0442\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C",await e.dispatch("settingsConfigurable/load","ownership-type")),u.value=!0},l=()=>{u.value=!1,d.value="",i.value=""};V(()=>o.users,(g,q)=>{f.value=g});async function A(){u.value=!1,s("update-table")}async function M(g){await e.dispatch("auth/remove",g),u.value=!1,d.value="",i.value="",s("update-table")}return{initialPagination:{sortBy:"companyShortName",descending:!1,page:1,rowsPerPage:10},columns:O,rows:f,loading:b,modal:u,modalType:d,modalTitle:i,currentUser:_,showModal:a,closeModal:l,deleteUser:M,updateUsers:A}}},$={class:"w-100"},ee={key:0},ae={key:1},te={key:2},se={class:"text-bold"},oe={style:{"max-width":"250px","white-space":"normal"}},le={key:0,class:"q-card__section q-card__section--vert"},ne={key:1,class:"q-card__actions justify-end q-card__actions--horiz row"},re=c("span",{class:"q-focus-helper"},null,-1),ie=c("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[c("span",{class:"block"},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C")],-1),ce=[re,ie],de=c("span",{class:"q-focus-helper"},null,-1),ue=c("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[c("span",{class:"block"},"\u041E\u0442\u043C\u0435\u043D\u0430")],-1),me=[de,ue];function pe(o,s,b,e,f,u){const d=y("AppLoader"),i=y("UsersForm"),_=y("app-modal");return r(),m("div",$,[e.loading?(r(),m("div",ee,[t(d)])):!e.loading&&!e.rows.length?(r(),m("div",ae," \u0423\u0447\u0435\u0442\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u044B ")):(r(),m("div",te,[t(I,{rows:e.rows,columns:e.columns,"row-key":"name",pagination:e.initialPagination},{header:n(a=>[t(K,{props:a},{default:n(()=>[(r(!0),m(L,null,j(a.cols,l=>(r(),v(J,{key:l.name,props:a,class:"text-center"},{default:n(()=>[c("span",se,h(l.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-companyFullName":n(a=>[t(k,{props:a},{default:n(()=>[c("div",oe,h(a.row.companyFullName),1)]),_:2},1032,["props"])]),"body-cell-firstName":n(a=>[t(k,{props:a},{default:n(()=>[T(h(a.row.firstName+" "+a.row.secondName+" "+a.row.lastName),1)]),_:2},1032,["props"])]),"body-cell-control":n(a=>[t(k,{props:a},{default:n(()=>[c("div",null,[t(C,{class:"bg-orange q-mr-sm",icon:"edit_note",onClick:l=>e.showModal(a.row)},null,8,["onClick"]),t(C,{class:"bg-red",icon:"delete",onClick:l=>e.showModal(a.row,"delete")},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])),(r(),v(z,{to:"body"},[t(_,{title:e.modalTitle,show:e.modal,onClose:e.closeModal,fullSize:e.modalType!="delete"},{default:n(()=>[e.modalType=="delete"?(r(),m("div",le,[T(" \u0423\u0447\u0435\u0442\u043D\u0430\u044F \u0437\u0430\u043F\u0438\u0441\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F "),c("b",null,h(e.currentUser.name),1),T(" \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u0430. \u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435? ")])):B("",!0),e.modalType=="delete"?(r(),m("div",ne,[c("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:s[0]||(s[0]=a=>e.deleteUser(e.currentUser._id))},ce),c("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-positive q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:s[1]||(s[1]=(...a)=>e.closeModal&&e.closeModal(...a))},me)])):(r(),v(i,{key:2,buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"update",user:e.currentUser,onSuccess:e.updateUsers,resetPassword:""},null,8,["user","onSuccess"]))]),_:1},8,["title","show","onClose","fullSize"])]))])}var be=x(W,[["render",pe]]);const fe={title:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\u043C\u0438",titleTemplate:o=>`${o} | \u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0441\u043A\u0438\u0435 \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0438`},_e={setup(){E(fe);const o=Q(),s=p(!1),b=p(""),e=D(()=>o.getters.usersTabsActive),f=p([]),u=p([]),d=p([]);R(async()=>{s.value=!0,b.value=e.value,await o.dispatch("auth/loadUsers"),f.value=o.getters["auth/users"],u.value=o.getters["auth/users"].filter(a=>a.roles.includes("admin")),d.value=o.getters["auth/users"].filter(a=>a.roles.includes("user")),s.value=!1});const i=a=>{o.dispatch("setUsersTab",a)};V(()=>e.value,(a,l)=>{b.value=a});async function _(a){await o.dispatch("auth/loadUsers"),f.value=o.getters["auth/users"],u.value=o.getters["auth/users"].filter(l=>l.roles.includes("admin")),d.value=o.getters["auth/users"].filter(l=>l.roles.includes("user")),(a==null?void 0:a.role)=="user"?i("users"):(a==null?void 0:a.role)=="admin"&&i("admins")}return{tab:b,loading:s,adminUsers:u,clientUsers:d,updateUsers:_,changeTab:i}},components:{AppPage:X,AppLoader:N,UsersForm:S,UsersTable:be}},ge={class:"q-gutter-y-md"},ye={key:0,class:"row justify-center"},he={key:1},ve={key:0,class:"row justify-center"},we={key:1},Ue={class:"row justify-center"};function Te(o,s,b,e,f,u){const d=y("UsersTable"),i=y("AppLoader"),_=y("UsersForm"),a=y("app-page");return r(),v(a,{title:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u044F \u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043D\u044B\u0435 \u043B\u0438\u0446\u0430"},{default:n(()=>[c("div",ge,[t(G,null,{default:n(()=>[t(Y,{modelValue:e.tab,"onUpdate:modelValue":s[3]||(s[3]=l=>e.tab=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:n(()=>[t(w,{name:"users",label:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438",onClick:s[0]||(s[0]=l=>e.changeTab("users"))}),t(w,{name:"admins",label:"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u044B",onClick:s[1]||(s[1]=l=>e.changeTab("admins"))}),t(w,{name:"register",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",onClick:s[2]||(s[2]=l=>e.changeTab("register"))})]),_:1},8,["modelValue"]),t(Z),t(P,{modelValue:e.tab,"onUpdate:modelValue":s[4]||(s[4]=l=>e.tab=l),animated:""},{default:n(()=>[t(U,{name:"users"},{default:n(()=>[e.loading?(r(),m("div",he,[t(i)])):(r(),m("div",ye,[t(d,{users:e.clientUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),t(U,{name:"admins"},{default:n(()=>[e.loading?(r(),m("div",we,[t(i)])):(r(),m("div",ve,[t(d,{users:e.adminUsers,onUpdateTable:e.updateUsers},null,8,["users","onUpdateTable"])]))]),_:1}),t(U,{name:"register"},{default:n(()=>[c("div",Ue,[t(_,{buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"register",onSuccess:e.updateUsers},null,8,["onSuccess"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}var Le=x(_e,[["render",Te]]);export{Le as default};
