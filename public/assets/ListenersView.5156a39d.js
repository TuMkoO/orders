import{_ as B,$ as U,r as _,b as A,C as L,o as V,a0 as h,h as n,e as p,g as r,f as s,k,w as u,P as f,j as M,as as g,Q as F,R as P,S as j,X as N,Y as x,at as H,au as z,av as R,u as D,Z as E}from"./index.8f4ba276.js";import{A as X,Q,a as Y,b as Z}from"./AppModal.1a346ccd.js";import{Q as G}from"./QTr.d81d2660.js";import{L as J}from"./ListenersForm.dfc1b1fd.js";import"./ClosePopup.3e6bc9ec.js";import"./use-checkbox.7375de5c.js";import"./QCard.c534bcc0.js";import"./use-cache.b0833c75.js";import"./QToggle.8dd1a35f.js";import"./QCardSection.21b087d5.js";import"./array.12f4553f.js";import"./QCardActions.d38c7677.js";const K=[{name:"fio",required:!0,label:"\u0424\u0418\u041E",align:"left",field:o=>o.firstName+" "+o.secondName+" "+o.lastName,format:o=>`${o}`,sortable:!0},{name:"post",align:"left",label:"\u0414\u043E\u043B\u0436\u043D\u043E\u0441\u0442\u044C",field:"post",sortable:!0},{name:"company",align:"left",label:"\u041F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u0435",field:"ownerUser",sortable:!0},{name:"phone",align:"left",label:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",field:"phone",sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"status",align:"left",label:"\u0421\u0442\u0430\u0442\u0443\u0441",field:"status",sortable:!0},{name:"control",align:"center",label:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435",field:""}],O={components:{AppLoader:U,AppModal:X,ListenersForm:J},setup(){const o=_(!1),t=A(),l=_(""),e=L(()=>t.getters["listener/listeners"]),q=L(()=>t.getters["listener/listeners"].filter(d=>l.value?d.firstName.toLowerCase().includes(l.value.toLowerCase())||d.secondName.toLowerCase().includes(l.value.toLowerCase())||d.lastName.toLowerCase().includes(l.value.toLowerCase())||a.value.companyShortName.toLowerCase().includes(l.value.toLowerCase())||a.value.companyFullName.toLowerCase().includes(l.value.toLowerCase())||i.value.filter(b=>b._id==d.ownerUser)[0].companyShortName.toLowerCase().includes(l.value.toLowerCase())||i.value.filter(b=>b._id==d.ownerUser)[0].companyFullName.toLowerCase().includes(l.value.toLowerCase()):!0)),y=_(!1),m=_(""),c=_(""),v=_(),a=L(()=>t.getters["auth/user"]),i=L(()=>t.getters["auth/users"]),w=_(!1);V(async()=>{a.value.roles.length&&(a.value.roles.includes("admin")||a.value.roles.includes("god")?(w.value=!0,o.value=!0,await t.dispatch("auth/loadUsers"),o.value=!1):w.value=!1)});const S=async()=>{o.value=!0,w.value?await t.dispatch("listener/load"):await t.dispatch("listener/loadByCompany",a.value.id),o.value=!1},I=async(d,b)=>{b&&(v.value=await t.dispatch("listener/loadById",b._id)),d=="delete"?(m.value="delete",c.value="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F"):d=="add"?(m.value="add",c.value="\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0433\u043E \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F",w.value&&await t.dispatch("auth/loadUsers")):d=="edit"&&(m.value="edit",c.value="\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F",w.value&&await t.dispatch("auth/loadUsers")),y.value=!0},T=()=>{y.value=!1,m.value="",c.value=""};return{initialPagination:{sortBy:"fio",descending:!1,page:1,rowsPerPage:10},user:a,users:i,search:l,columns:K,loading:o,rows:e,filteredRows:q,modal:y,modalTitle:c,modalType:m,currentListener:v,showModal:I,closeModal:T,deleteListener:async d=>{await t.dispatch("listener/remove",d),S(),T()},updateListener:()=>{S(),T()}}}},C=o=>(z("data-v-fd8292da"),o=o(),R(),o),W={class:"w-100"},$={key:0},ee={key:1},te=C(()=>s("p",{class:"text-center"},"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438 \u043D\u0435 \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u044B",-1)),ae={class:"text-center"},oe={key:2},se={class:"row justify-between"},le={style:{flex:"1"}},ne={key:0},re={class:"text-bold"},ie={class:"table-nav"},de={key:0,class:"q-card__section q-card__section--vert"},ce={key:1,class:"q-card__actions justify-end q-card__actions--horiz row"},ue=C(()=>s("span",{class:"q-focus-helper"},null,-1)),me=C(()=>s("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[s("span",{class:"block"},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C")],-1)),pe=[ue,me],_e=C(()=>s("span",{class:"q-focus-helper"},null,-1)),fe=C(()=>s("span",{class:"q-btn__content text-center col items-center q-anchor--skip justify-center row"},[s("span",{class:"block"},"\u041E\u0442\u043C\u0435\u043D\u0430")],-1)),ve=[_e,fe];function be(o,t,l,e,q,y){const m=h("AppLoader"),c=h("ListenersForm"),v=h("app-modal");return n(),p("div",W,[e.loading?(n(),p("div",$,[r(m)])):!e.loading&&!e.rows.length?(n(),p("div",ee,[te,s("div",ae,[r(k,{label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",type:"button",color:"primary",onClick:t[0]||(t[0]=a=>e.showModal("add"))})])])):(n(),p("div",oe,[s("div",se,[s("div",le,[r(F,{"bottom-slots":"",modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=a=>e.search=a),label:"\u0414\u043B\u044F \u0444\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041E \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044F \u0438\u043B\u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043F\u0440\u0438\u044F\u0442\u0438\u044F"},{append:u(()=>[e.search!==""?(n(),f(M,{key:0,name:"close",onClick:t[1]||(t[1]=a=>e.search=""),class:"cursor-pointer"})):g("",!0),r(M,{name:"search"})]),_:1},8,["modelValue"])])]),e.user&&e.users?(n(),p("div",ne,[r(Y,{rows:e.filteredRows,columns:e.columns,"row-key":"name",pagination:e.initialPagination},{header:u(a=>[r(G,{props:a},{default:u(()=>[(n(!0),p(P,null,j(a.cols,i=>(n(),f(Z,{key:i.name,props:a,class:"text-center"},{default:u(()=>[s("span",re,x(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-company":u(a=>[r(Q,{props:a},{default:u(()=>[N(x(a.row.ownerUser==e.user.id?e.user.companyShortName:e.users.map(i=>i).filter(i=>i._id==a.row.ownerUser)[0].companyShortName),1)]),_:2},1032,["props"])]),"body-cell-control":u(a=>[r(Q,{props:a},{default:u(()=>[s("div",null,[r(k,{class:"bg-orange q-mr-sm",icon:"edit_note",onClick:i=>e.showModal("edit",a.row)},null,8,["onClick"]),r(k,{class:"bg-red",icon:"delete",onClick:i=>e.showModal("delete",a.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])):g("",!0),s("div",ie,[r(k,{fab:"",icon:"add",onClick:t[3]||(t[3]=a=>e.showModal("add")),color:"secondary"})])])),(n(),f(H,{to:"body"},[r(v,{title:e.modalTitle,show:e.modal,fullSize:e.modalType!="delete",onClose:e.closeModal},{default:u(()=>[e.modalType=="delete"?(n(),p("div",de,[N(" \u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044C "),s("b",null,x(e.currentListener.firstName+" "+e.currentListener.secondName+" "+e.currentListener.lastName),1),N(" \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043B\u0451\u043D. \u0412\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435? ")])):g("",!0),e.modalType=="delete"?(n(),p("div",ce,[s("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-negative q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:t[4]||(t[4]=a=>e.deleteListener(e.currentListener._id))},pe),s("button",{class:"q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-positive q-btn--actionable q-focusable q-hoverable",tabindex:"0",type:"button",onClick:t[5]||(t[5]=(...a)=>e.closeModal&&e.closeModal(...a))},ve)])):g("",!0),e.modalType=="add"?(n(),f(c,{key:2,buttonTitle:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",submitType:"add",onSuccess:e.updateListener,onHide:e.closeModal},null,8,["onSuccess","onHide"])):e.modalType=="edit"?(n(),f(c,{key:3,buttonTitle:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",submitType:"update",listener:e.currentListener,onSuccess:e.updateListener,onHide:e.closeModal},null,8,["listener","onSuccess","onHide"])):g("",!0)]),_:1},8,["title","show","fullSize","onClose"])]))])}var he=B(O,[["render",be],["__scopeId","data-v-fd8292da"]]);const ye={title:"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438",titleTemplate:o=>`${o} | \u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0441\u043A\u0438\u0435 \u0442\u0435\u0445\u043D\u043E\u043B\u043E\u0433\u0438\u0438`},we={setup(){D(ye);const o=_(!1),t=A(),l=L(()=>t.getters["auth/user"]);return V(async()=>{o.value=!0,l.value.roles.length&&(l.value.roles.includes("admin")||l.value.roles.includes("god")?await t.dispatch("listener/load"):await t.dispatch("listener/loadByCompany",l.value.id)),o.value=!1}),{loading:o}},components:{AppPage:E,AppLoader:U,ListenersTable:he}},ge={class:"q-gutter-y-md"},Le={key:0};function Ce(o,t,l,e,q,y){const m=h("AppLoader"),c=h("ListenersTable"),v=h("app-page");return n(),f(v,{title:"\u0421\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438"},{default:u(()=>[s("div",ge,[e.loading?(n(),p("div",Le,[r(m)])):(n(),f(c,{key:1}))])]),_:1})}var Pe=B(we,[["render",Ce]]);export{Pe as default};
